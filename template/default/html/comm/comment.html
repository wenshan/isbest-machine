{pboot:if({pboot:commentstatus})}
<div class="container">
  <div class="shadow-sm p-3 my-5 bg-white rounded">
    <h4>Post comments：</h4>
    <form class="my-4" onsubmit="return submitcomment(this);" data-action="{pboot:commentaction}">
      <div class="form-group">
        <textarea name="comment" id="comment" class="form-control"
          placeholder="Please enter the comment content"></textarea>
      </div>

      {pboot:2if({pboot:commentcodestatus})}
      <div class="form-group">
        <div class="row">
          <div class="col-6 col-md-3">
            <input type="text" name="checkcode" required id="checkcode" class="form-control"
              placeholder="Please enter the verification code">
          </div>
          <div class="col-6  col-md-3">
            <img title="点击刷新" class="codeimg" style="height:33px;" src="{pboot:checkcode}"
              onclick="this.src='{pboot:checkcode}?'+Math.round(Math.random()*10);" />
          </div>
        </div>
      </div>
      {/pboot:2if}

      <div class="form-group">
        <button type="submit" class="btn btn-info mb-2">Submit comments</button>
      </div>
    </form>
    <!-- 分页 -->
    {pboot:2if({page:rows}>0)}
    <nav aria-label="page navigation" class="my-4">
      <div class="pagination justify-content-center">
        <a class="page-item page-link" href="{page:index}#comment">Home</a>
        <a class="page-item page-link" href="{page:pre}#comment">Prev</a>
        <a class="page-item page-link" href="{page:next}#comment">Next</a>
        <a class="page-item page-link" href="{page:last}#comment">End</a>
      </div>
    </nav>
    {2else}
    <div class="text-center my-5 text-secondary">No data found!</div>
    {/pboot:2if}
  </div>
</div>

<!-- 评论回复弹框 -->
<div class="modal" tabindex="-1" role="dialog" id="reply">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Reply to comments：</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <form onsubmit="return submitcomment(this);" data-action="" id="replyform">
        <div class="modal-body">
          <div class="form-group">
            <textarea name="comment" id="comment" class="form-control"
              placeholder="Please enter the comment content"></textarea>
          </div>
          {pboot:2if({pboot:commentcodestatus})}
          <div class="form-group">
            <div class="row">
              <div class="col-6">
                <input type="text" name="checkcode" required id="checkcode" class="form-control"
                  placeholder="Please enter the verification code">
              </div>
              <div class="col-6">
                <img title="Click to refresh" class="codeimg" style="height:33px;" src="{pboot:checkcode}"
                  onclick="this.src='{pboot:checkcode}?'+Math.round(Math.random()*10);" />
              </div>
            </div>
          </div>
          {/pboot:2if}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">close</button>
          <button type="submit" class="btn btn-info">Submit comments</button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>

  //评论回复弹框
  $('.replybtn').on("click", function () {
    var url = $(this).data("action");
    $("#reply").modal("show");
    $("#replyform").data("action", url);
  });

  //提交评论
  function submitcomment(obj) {
    var url = $(obj).data("action");
    var comment = $(obj).find("#comment").val();
    var checkcode = $(obj).find("#checkcode").val();

    $.ajax({
      type: 'POST',
      url: url,
      dataType: 'json',
      data: {
        comment: comment,
        checkcode: checkcode
      },
      success: function (response, status) {
        if (response.code) {
          alert(response.data);
          $(obj)[0].reset();
          $(".modal").modal("hide");
          window.location.reload()
        } else {
          if (response.tourl != "") {
            if (confirm(response.data + '是否立即跳转登录？')) {
              location.href = response.tourl;
            }
          }
          $('.codeimg').click();//更新验证码
        }
      },
      error: function (xhr, status, error) {
        alert('返回数据异常！');
      }
    });
    return false;
  }
</script>
{/pboot:if}